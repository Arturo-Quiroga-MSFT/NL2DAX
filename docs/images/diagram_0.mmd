flowchart LR
	U[User NL question] --> P[NL Parser\nLangChain + Azure OpenAI]
	S[Schema Metadata\n(cache + live)] --> P
	P -->|Intent + Entities| G1[DAX Generator]
	P -->|Intent + Entities| G2[SQL Generator]
	G1 --> FMT[DAX Format/Validate (optional)]
	G2 --> SAN[SQL Sanitize/Extract Code]
	FMT --> OUT[Output + RESULTS/*.txt]
	SAN --> SQLX[SQL Executor\nAzure SQL ODBC]
	SQLX --> OUT
	G1 -->|DAX (optional)| DAXX[DAX Executor via XMLA]
	DAXX --> OUT
	subgraph Storage
	  CSH[schema_cache.json]
	end
	CSH --> S
