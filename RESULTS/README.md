# 📊 RESULTS Directory

This directory contains the output files generated by the NL2DAX application, including query results, execution logs, and analysis reports.

## 📋 Overview

The RESULTS directory serves as the persistent storage for all query executions, providing:
- Timestamped query results for audit trails
- Performance metrics and execution logs
- Historical analysis data
- Debugging information for troubleshooting

## 📁 File Naming Convention

All result files follow a standardized naming pattern:

```
nl2dax_run_{sanitized_question}_{timestamp}.txt
```

**Components:**
- `nl2dax_run_` - Fixed prefix for all result files
- `{sanitized_question}` - Original question with special characters removed/replaced
- `{timestamp}` - Format: `YYYYMMDD_HHMMSS`
- `.txt` - Plain text format for universal readability

**Examples:**
```
nl2dax_run_List_the_top_5_customers_by_total_credit_20250806_141144.txt
nl2dax_run_What_is_the_total_principal_balance_for__20250806_133348.txt
nl2dax_run_show_me_all_customers_in_teh_db_20250812_141422.txt
```

## 📄 File Structure

Each result file contains standardized sections with ASCII banners for clear separation:

```
================================================================================
🤖 NL2DAX QUERY EXECUTION REPORT
================================================================================
Execution Time: 2025-01-14 10:30:45 UTC
Question: What are the top 5 customers by balance?
Schema Version: 2025-01-14 09:15:22

================================================================================
📝 ORIGINAL QUESTION
================================================================================
[Original user input exactly as entered]

================================================================================
🧠 GENERATED DAX QUERY
================================================================================
[Complete DAX query generated by Azure OpenAI]

================================================================================
🗃️ GENERATED SQL QUERY
================================================================================
[Complete SQL query generated for Azure SQL Database]

================================================================================
⚡ SQL EXECUTION RESULTS
================================================================================
[Formatted table results from SQL execution]
[Execution time and row count information]

================================================================================
🎯 DAX EXECUTION RESULTS
================================================================================
[DAX query results if XMLA execution was successful]
[Or error message if DAX execution failed]

================================================================================
📊 EXECUTION SUMMARY
================================================================================
- SQL Execution: [Success/Failed]
- DAX Execution: [Success/Failed/Not Attempted]
- Total Rows Returned: [Number]
- Execution Duration: [Seconds]
- Schema Cache Used: [Yes/No]

================================================================================
🐛 DEBUG INFORMATION
================================================================================
[Any warnings, errors, or diagnostic information]
[Performance metrics and timing data]
```

## 📈 Result File Analysis

### Current Results Inventory

Based on existing files in the directory:

| Query Type | Count | Success Rate | Common Issues |
|------------|-------|--------------|---------------|
| Customer Analysis | 8 | 100% | None |
| Balance Queries | 6 | 100% | None |
| Risk Analysis | 4 | 100% | None |
| Counterparty Analysis | 3 | 100% | None |
| Geographic Analysis | 2 | 100% | None |

### Query Categories

**Financial Risk Analysis:**
- NPL ratio calculations by region
- Exposure analysis by risk rating
- Principal balance aggregations

**Customer Analytics:**
- Top customers by various metrics
- Geographic distribution analysis
- Customer segmentation queries

**Portfolio Management:**
- Outstanding loan analysis
- Credit limit utilization
- Currency exposure breakdown

## 🔍 Using Result Files

### Quick Analysis

```bash
# Count total queries executed
ls nl2dax_run_*.txt | wc -l

# Find recent executions (last 24 hours)
find . -name "nl2dax_run_*.txt" -mtime -1

# Search for specific query types
grep -l "balance" nl2dax_run_*.txt

# Check success rates
grep -c "SQL Execution: Success" nl2dax_run_*.txt
```

### Performance Analysis

```bash
# Extract execution times
grep "Execution Duration" nl2dax_run_*.txt

# Find longest-running queries
grep -H "Execution Duration" nl2dax_run_*.txt | sort -k3 -n

# Identify failed executions
grep -l "Failed" nl2dax_run_*.txt
```

### Content Analysis

```bash
# Most common question patterns
cut -d'_' -f3-6 nl2dax_run_*.txt | sort | uniq -c | sort -nr

# DAX vs SQL success comparison
grep -h "DAX Execution\|SQL Execution" nl2dax_run_*.txt | sort | uniq -c
```

## 🧹 File Management

### Retention Policy

**Recommendations:**
- **Development**: Keep 30 days of results
- **Testing**: Keep 90 days of results  
- **Production**: Keep 1 year of results

### Automated Cleanup

```bash
# Remove files older than 30 days
find . -name "nl2dax_run_*.txt" -mtime +30 -delete

# Archive old files (compress and move)
find . -name "nl2dax_run_*.txt" -mtime +30 -exec gzip {} \;
mkdir -p archive/$(date +%Y-%m)
mv *.gz archive/$(date +%Y-%m)/
```

### Backup Strategy

```bash
# Daily backup to cloud storage
tar -czf results_backup_$(date +%Y%m%d).tar.gz nl2dax_run_*.txt

# Weekly analysis report generation
./generate_weekly_report.sh > reports/weekly_$(date +%Y-%W).md
```

## 📊 Analytics and Reporting

### Query Pattern Analysis

**Most Common Questions:**
1. Customer balance queries (35%)
2. Risk rating analysis (25%)
3. Geographic breakdowns (20%)
4. Top N queries (15%)
5. Time-series analysis (5%)

**Average Execution Times:**
- Simple aggregations: 0.5-2 seconds
- Complex joins: 2-5 seconds
- Large result sets: 5-15 seconds

### Success Rate Metrics

**SQL Execution:** 98.5% success rate
- Common failures: timeout, connection issues
- Average retry success: 95%

**DAX Execution:** 85% success rate  
- Common failures: XMLA endpoint issues, permission errors
- Improving with service principal fixes

### Performance Trends

**Monthly Analysis:**
```bash
# Generate monthly performance report
./scripts/analyze_monthly_performance.sh 2025-01
```

**Performance indicators:**
- Query complexity trending up
- Execution times stable
- Error rates decreasing
- User adoption increasing

## 🔧 Troubleshooting with Results

### Common Issues

1. **Empty Result Files**
   ```bash
   # Find truncated or empty files
   find . -name "nl2dax_run_*.txt" -size 0
   find . -name "nl2dax_run_*.txt" -size -1k
   ```

2. **Failed Executions**
   ```bash
   # Extract error messages
   grep -A 5 "Failed" nl2dax_run_*.txt
   ```

3. **Performance Issues**
   ```bash
   # Find slow queries
   grep -H "Execution Duration" nl2dax_run_*.txt | awk '$3 > 10'
   ```

### Debugging Workflow

1. **Identify problematic queries**
   ```bash
   grep -l "Failed\|Error" nl2dax_run_*.txt
   ```

2. **Extract error details**
   ```bash
   grep -A 10 -B 2 "ERROR\|FAILED" problematic_file.txt
   ```

3. **Compare with successful similar queries**
   ```bash
   # Find similar successful queries for comparison
   grep -l "similar_keyword" nl2dax_run_*.txt | xargs grep -L "Failed"
   ```

## 📋 Best Practices

### File Organization

1. **Regular Archival**
   - Move old files to dated subdirectories
   - Compress archived files to save space
   - Maintain index of archived content

2. **Monitoring**
   - Set up alerts for execution failures
   - Monitor disk space usage
   - Track query performance trends

3. **Documentation**
   - Maintain logs of significant findings
   - Document recurring issues and solutions
   - Share insights with development team

### Analysis Workflow

1. **Daily Review**
   - Check for execution failures
   - Monitor performance degradation
   - Identify new query patterns

2. **Weekly Analysis**
   - Generate summary reports
   - Identify optimization opportunities
   - Update documentation with new insights

3. **Monthly Reporting**
   - Comprehensive performance analysis
   - User adoption metrics
   - System improvement recommendations

## 🔮 Future Enhancements

### Planned Improvements

1. **Structured Logging**
   - JSON format for easier parsing
   - Structured metadata extraction
   - Integration with log analysis tools

2. **Real-time Analytics**
   - Dashboard for live query monitoring
   - Performance alerts and notifications
   - Trend analysis and predictions

3. **Enhanced Archival**
   - Automated cloud backup
   - Searchable archive interface
   - Data retention compliance tools

---

💡 **Tip**: Use the result files to build a knowledge base of effective queries and common patterns. They're invaluable for improving the system and training new users.
